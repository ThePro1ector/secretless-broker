version: 2
services:
  stripe:
    connector: generic_http
    listenOn: tcp://0.0.0.0:8071
    credentials:
      token:
        from: keychain
        get: service#stripe/token
    config:
      headers:
        Authorization: Bearer {{ .token }}
      forceSSL: true
      authenticateURLsMatching:
        - ^http[s]*\:\/\/api\.stripe\.com*
  stripe-account:
    connector: generic_http
    listenOn: tcp://0.0.0.0:8081
    credentials:
      token:
        from: keychain
        get: service#stripe/token
      stripe_account:
        from: keychain
        get: service#stripe/account-id
    config:
      headers:
        Authorization: Bearer {{ .token }}
        Stripe-Accout: "{{ .stripe_account }}"
      forceSSL: true
      authenticateURLsMatching:
        - ^http[s]*\:\/\/api\.stripe\.com*
  stripe-idempotency:
    connector: generic_http
    listenOn: tcp://0.0.0.0:8091
    credentials:
      token:
        from: keychain
        get: service#stripe/token
      idempotency_key:
        from: keychain
        get: service#stripe/indempotency-key
    config:
      headers:
        Authorization: Bearer {{ .token }}
        Idempotency-Key: "{{ .idempotency_key }}"
      forceSSL: true
      authenticateURLsMatching:
        - ^http[s]*\:\/\/api\.stripe\.com*
  stripe-account-idempotency:
    connector: generic_http
    listenOn: tcp://0.0.0.0:9001
    credentials:
      token:
        from: keychain
        get: service#stripe/token
      stripe_account:
        from: keychain
        get: service#stripe/account-id
      idempotency_key:
        from: keychain
        get: service#service/idempotency-key
    config:
      headers:
        Authorization: Bearer {{ .token }}
        Stripe-Account: "{{ .stripe_account }}"
        Idempotency-Key: "{{ .idempotency_key }}"
      forceSSL: true
      authenticateURLsMatching:
        - ^http[s]*\:\/\/api\.stripe\.com*
